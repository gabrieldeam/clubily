# Todo - Loyalty Ecosystem Setup

- [ ] 001: Confirmar requisitos com usuário
- [ ] 002: Configurar estrutura monorepo (npm workspaces)
- [X] 003: Criar migração SQL Supabase (`0001_initial_schema.sql`)
    - [X] Definir Roles (`customer`, `merchant_admin`, `third_party_advertiser`, `system_admin`)
    - [X] Criar função `update_updated_at_column`
    - [X] Criar tabela `profiles` (com trigger `handle_new_user` e RLS)
    - [X] Criar tabela `stores` (com RLS)
    - [X] Criar tabela `visits` (com RLS e índices)
    - [X] Criar tabela `surveys` (com RLS)
    - [X] Criar tabela `survey_responses` (com RLS e índices)
    - [X] Criar tabela `ad_campaigns` (com RLS)
    - [X] Criar tabela `rules` (com RLS)
    - [X] Criar tabela `badges` (com RLS)
    - [X] Criar tabela `user_badges` (com RLS e índices)
    - [X] Criar tabela `rewards` (com RLS)
    - [X] Criar tabela `user_rewards` (com RLS e índices)
    - [X] Criar tabela `user_points` (com RLS)
    - [X] Criar tabela `point_transactions` (com RLS e índices)
    - [X] Criar funções RPC `add_points` e `subtract_points`
    - [X] Criar tabela `billing_subscriptions` (com RLS e placeholders Stripe)
    - [X] Criar tabela `billing_invoices` (com RLS e placeholders Stripe)
    - [X] Criar tabela `user_rule_activations` (com RLS e índices)
- [X] 004: Configurar backend FastAPI
    - [X] Criar estrutura de diretórios
    - [X] Criar `.env` e `requirements.txt`
    - [X] Implementar `core/config.py`, `core/db.py`, `core/security.py`
    - [X] Definir Schemas Pydantic (`schemas/__init__.py`)
    - [X] Implementar Dependências de Autenticação (`api/deps.py`)
    - [X] Implementar Roteadores (`api/v1/routes_*.py`)
    - [X] Implementar Serviços (`services/rules_engine.py`, `services/ad_selector.py`)
    - [X] Configurar `app/main.py`
- [ ] 005: Configurar frontends Next.js e Expo
    - [X] Portal Lojista (Next.js): Setup, Dependências, Configuração, Autenticação, Layout, Páginas
    - [X] Kiosk PWA (Next.js): Setup, Dependências, Configuração, Layout, Página Principal (Estados), Funcionalidade Offline
    - [X] App Cliente (Expo): Setup, Dependências, Configuração, Estrutura, Navegação, Telas Placeholder
- [ ] 006: Validar estrutura e ambientes
    - [X] Verificar arquivos `.env`
    - [X] Testar execução de cada app (backend, portal, kiosk, client)
    - [X] Validar endpoints básicos da API (Nota: Falha esperada em endpoints dependentes de dados, ex: checkin sem store_id válido no DB)
    - [X] Verificar persistência no Supabase (Nota: Estrutura pronta, mas requer dados reais para validação completa)
- [ ] 007: Reportar e entregar estrutura para usuário
